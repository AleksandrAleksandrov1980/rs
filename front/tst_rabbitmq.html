<html>

   <head>
      <title>JavaScript MQTT WebSocket Example</title>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
     </script>
     <script type = "text/javascript" language = "javascript">
        var mqtt;
        var reconnectTimeout = 2000;
        //var host="1.2.3.4"; //change this
        //var host="192.168.1.59"; //change this
        //var host = "127.0.0.1"; //change this
        //var host = "localhost";
        host = "ws://127.0.0.1:15675/ws/"
        //var port = 15675;//1883; //5672 // 15674 // 15672
        //port = 15675;
        var lastMsg;

        function onFailure(message) {
            console.log("Connection Attempt to Host "+host+"Failed");
            setTimeout(MQTTconnect, reconnectTimeout);
        }
        function onMessageArrived(msg){
            out_msg="Message received "+msg.payloadString+"<br>";
            out_msg=out_msg+"Message received Topic "+msg.destinationName;
            console.log(out_msg);
            document.write(msg.payloadString);
        }

        function onConnect() {
      // Once a connection has been made, make a subscription and send a message.

        console.log("Connected ");
        
        document.write("connected to "+ host);
        //mqtt.subscribe("ApolloTemp");
        mqtt.subscribe("/exchange/logs");
        message = new Paho.MQTT.Message("Client Connected Sucessfully");
        //message.destinationName = "ApolloTemp";
        message.destinationName = "/exchange/logs";
        mqtt.send(message); 

        for(i=0;i<1000;i++)
        {
            message = new Paho.MQTT.Message("Client Connected Sucessfully");
            message.destinationName = "/exchange/logs";
            mqtt.send(message);
        }

      }

      function MQTTconnect() 
      {
        //console.log("connecting to "+ host +" "+ port);
        console.log("connecting to "+ host );
        var clientID = "clientjs_" + new Date().getTime();
        mqtt = new Paho.MQTT.Client(host,clientID);

        var wsbroker = "192.168.1.59";  //mqtt websocket enabled broker
        var wsport = 15675; // port for above
        var client = new Paho.MQTT.Client(wsbroker, wsport, "/ws",
        "myclientid_" + parseInt(Math.random() * 100, 10));

        //mqtt = new Paho.MQTT.Client(host,port,"clientjs");
       // mqtt = new Paho.MQTT.Client(host,port,"/");
        document.write("connecting to "+ host);
        //userName : "guest",
        //password : "guest",
        var options = {
            timeout: 3,
            userName : "rastr",
            password : "rastr",
            onSuccess: onConnect,
            onFailure: onFailure,
             };
        mqtt.onMessageArrived = onMessageArrived;
        mqtt.onConnectionLost = function (responseObject) {
            console.log("connection lost: " + responseObject.errorMessage);
        };
        mqtt.connect(options); //connect

      }  
      </script>

   </head>
     <body>
   <h1>Main Body</h1>
    <script>
    //MQTTconnect();
       MQTTconnect();
    </script>

   </body>  
</html>